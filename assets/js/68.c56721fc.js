(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{371:function(e,n,s){"use strict";s.r(n);var t=s(5),a=Object(t.a)({},(function(){var e=this,n=e._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"贴吧自动签到插件开发"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#贴吧自动签到插件开发"}},[e._v("#")]),e._v(" 贴吧自动签到插件开发")]),e._v(" "),n("h2",{attrs:{id:"步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤"}},[e._v("#")]),e._v(" 步骤")]),e._v(" "),n("ol",[n("li",[e._v("manifest.json")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('{\n  "manifest_version": 3,\n  "name": "贴吧自动签到",\n  "version": "1.0",\n  "description": "This is my extension",\n  "icons": {\n    "16": "./icon/icon.jpg",\n    "48": "./icon/icon.jpg",\n    "128": "./icon/icon.jpg"\n  },\n  "action": {\n    "default_popup": "popup.html"\n  },\n  "background": {\n    "service_worker": "background.js"\n  },\n  "permissions": [\n    "storage",\n    "tabs",\n    "https://tieba.baidu.com/*",\n    "http://*/*",\n    "https://*/*",\n    "activeTab"\n  ],\n  "host_permissions": [\n    "https://tieba.baidu.com/"\n  ],\n  "content_scripts": [\n    {\n      "matches": [\n        "https://tieba.baidu.com/*"\n      ],\n      "js": [\n        "content.js"\n      ]\n    }\n  ],\n  "content_security_policy": {\n    "extension_pages": "script-src \'self\'; object-src \'self\'; connect-src https://tieba.baidu.com/;"\n  }\n}\n')])])]),n("ol",{attrs:{start:"2"}},[n("li",[e._v("background.js")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('chrome.tabs.create({\n  url: "https://tieba.baidu.com/index.html"\n});\n\nchrome.runtime.onInstalled.addListener(function () {\n  chrome.storage.local.set({ checkedIn: false });\n});\n\nchrome.runtime.onMessage.addListener(function (message, sender, sendResponse) {\n  debugger\n  console.log("Message received: " + JSON.stringify(message));\n  // Send a response back to the content script\n  sendResponse({ message: "Message received successfully!" });\n  if (message === "login") {\n    chrome.tabs.executeScript({ file: "login.js" });\n  } else if (message === "checkin") {\n    chrome.tabs.executeScript({ file: "checkin.js" });\n  }\n\n  if (message.type === "requestAvatar") {\n    fetch(message.url)\n      .then(response => response.json())\n      .then(data => console.log(data));\n    return true; // indicate that sendResponse will be called asynchronously\n  }\n});\n\nchrome.runtime.onInstalled.addListener(function () {\n  chrome.storage.local.set({ checkedIn: false });\n});\n')])])]),n("ol",{attrs:{start:"3"}},[n("li",[e._v("content.js")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('\n// 发送消息给background script\nchrome.runtime.sendMessage({ action: "getCSS" }, function (response) {\n  let css = response.css;\n  // 注入CSS样式\n  let style = document.createElement("style");\n  style.innerText = css;\n  document.head.appendChild(style);\n});\n\n// 监听background script发送的消息\nchrome.runtime.onMessage.addListener(function (message, sender, sendResponse) {\n  debugger;\n  if (message.action === "showMessage") {\n    alert(message.message);\n    sendResponse({ success: true });\n  }\n});\n\n// 通过 AJAX 请求获取用户头像\nwindow.addEventListener(\'load\', function () {\n  let userinfoUsernameEl = document.querySelector(\'.u_username\');\n  if (userinfoUsernameEl) {\n    let userinfoEl = userinfoUsernameEl.querySelector(\'a\');\n    if (userinfoEl) {\n      const idRegex = /id=([\\w.]+)/;\n      const match = userinfoEl.href.match(idRegex);\n      const userId = match && match[1];\n      let userProfileUrl = "https://tieba.baidu.com/home/main?un=" + userId;\n      chrome.runtime.sendMessage({ type: "requestAvatar", url: userProfileUrl }, function (response) {\n        // Parse response as HTML and extract the avatar URL\n        let doc = new DOMParser().parseFromString(response, "text/html");\n        alert(doc)\n        if (response) {\n          alert(response)\n          let avatarUrl = document.querySelector(".head_img").src;\n          alert(avatarUrl);\n        }\n\n      });\n    }\n  }\n});\n')])])]),n("ol",{attrs:{start:"4"}},[n("li",[e._v("popup.html")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('<!DOCTYPE html>\n<html>\n<head>\n  <title>My Extension</title>\n  <meta charset="utf-8">\n  <style>\n    body {\n      font-family: sans-serif;\n    }\n    img {\n      max-width: 100px;\n      max-height: 100px;\n    }\n    body {\n      height: 500px;\n      width: 300px;\n    }\n  </style>\n</head>\n<body>\n  <h1>贴吧自动签到</h1>\n  <h2>User Info:</h2>\n  <div id="user-info"></div>\n</body>\n<script src="./popup.js"><\/script>\n</html>\n')])])]),n("ol",{attrs:{start:"5"}},[n("li",[e._v("popup.js")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// chrome.storage.local.get(\"checkedIn\", function (data) {\n//   if (data && data.checkedIn) {\n//     document.getElementById(\"result\").innerHTML = \"今天已签到\";\n//   } else {\n//     document.getElementById(\"result\").innerHTML = \"今天未签到\";\n//   }\n// });\n\n\n// chrome.runtime.sendMessage(\"checkin\");\n\n// 获取当前登录用户的信息\nchrome.storage.sync.get(['userInfo'], function (result) {\n  var userInfo = result.userInfo;\n  console.log(userInfo, 'userInfo');\n  if (userInfo) {\n    var div = document.getElementById('user-info');\n    // 显示用户头像\n    var img = document.createElement('img');\n    img.src = userInfo.avatar;\n    div.appendChild(img);\n    // 显示用户名\n    var name = document.createElement('p');\n    name.textContent = 'Name: ' + userInfo.name;\n    div.appendChild(name);\n    // 显示用户关注的贴吧列表\n    var bars = document.createElement('p');\n    bars.textContent = 'Bars: ' + userInfo.bars.join(', ');\n    div.appendChild(bars);\n  }\n});\n")])])])])}),[],!1,null,null,null);n.default=a.exports}}]);